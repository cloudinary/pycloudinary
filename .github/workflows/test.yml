name: Cloudinary Python SDK Test

on:
  push:
    branches: [ "**" ]
  pull_request:
    branches: [ "**" ]

jobs:
  test:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        python-version:
          - 2.7
          - 3.9
          - 3.10
          - 3.11
          - 3.12
          - 3.13
        toxenv:
          - py27-core
          - py39-core
          - py310-core
          - py311-core
          - py312-core
          - py313-core
          - py27-django111
          - py39-django32
          - py310-django42
          - py311-django42
          - py312-django50
          - py313-django51

    steps:
    - uses: actions/checkout@v4
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v2
      with:
        python-version: ${{ matrix.python-version }}
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install tox pytest
    - name: Set up Cloudinary URL
      run: |
        export CLOUDINARY_URL=$(bash tools/get_test_cloud.sh)
        echo "cloud_name: $(echo $CLOUDINARY_URL | cut -d'@' -f2)"
    - name: Run tests
      run: |
        export PYTHONPATH="${PYTHONPATH}:$(pwd)"
        tox -e ${{ matrix.toxenv }}
